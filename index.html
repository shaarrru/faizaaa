<!-- 
  This code written for someone special 
  Don't you dare to use it for someone else! 
  ¬©Shaarrru
-->
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Faiza</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PTB0GN08KR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-PTB0GN08KR');
    </script>

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #CA7572;
            height: 100vh;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: background 3s ease;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .flower {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            animation: float 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }
        
        .imagen {
            margin-top: 16vh;
            height: 53vh;
            width: 32vh;
            position: relative;
            z-index: 1;
        }
        
        .titulo {
            margin-bottom: 180px;
            color: #F6F6EE;
            position: absolute;
            top: 14vh;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            font-size: 3vh;
            opacity: 0;
            animation: fadeIn 4s ease-in-out forwards;
            text-align: center;
            z-index: 1;
        }
        
        .score-container {
            position: fixed;
            top: 20px;
            right: 20px;
            text-align: center;
            z-index: 100;
            transition: opacity 1s ease;
        }
        
        .gotcha-title {
            font-size: 11px;
            font-weight: bold;
            color: #F6F6EE;
            margin-bottom: 3px;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(246, 246, 238, 0.3);
            animation: glowPulse 2s infinite alternate;
        }
        
        .score-value {
            font-size: 20px;
            color: #F6F6EE;
            font-weight: bold;
            display: block;
            margin-top: 5px;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        #final-state {
            position: fixed;
            background-color: #EDE5E2;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 3s ease;
        }
        
        #final-state.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .final-flower {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .final-image {
            height: 53vh;
            width: auto;
            max-width: 90%;
            object-fit: contain;
            position: relative;
            z-index: 1;
        }
        
        .final-title {
            color: #CA7572;
            font-size: 4rem;
            margin-bottom: 3rem;
            text-align: center;
            animation: gentlePulse 4s ease-in-out infinite;
        }
        
        @keyframes glowPulse {
            0% {
                text-shadow: 0 0 5px rgba(246, 246, 238, 0.3);
            }
            100% {
                text-shadow: 0 0 10px rgba(246, 246, 238, 0.8), 0 0 20px rgba(246, 246, 238, 0.4);
            }
        }
        
        @keyframes float {
            0%,
            100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes yellowPulse {
            from {
                text-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
            }
            to {
                text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            }
        }
        
        @keyframes butterflyExplode {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }
        
        @keyframes gentlePulse {
            0%,
            100% {
                transform: scale(1);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }
        
        @keyframes softFloat {
            0%,
            100% {
                transform: translateY(0) rotate(-2deg);
            }
            50% {
                transform: translateY(-25px) rotate(2deg);
            }
        }
        
        .firefly {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #fff8a6;
            border-radius: 50%;
            filter: blur(1px);
            box-shadow: 0 0 15px 5px #fff8a6;
            opacity: 0;
            z-index: 2;
            pointer-events: none;
            will-change: transform, opacity, box-shadow;
        }
        
        .butterfly_wrapper {
            width: 150px;
            height: 150px;
            position: absolute;
            z-index: 3;
            cursor: pointer;
            pointer-events: auto;
            will-change: transform;
            transition: opacity 1s ease-out;
        }
        
        .butterfly_wrapper .leftwings,
        .butterfly_wrapper .rightwings {
            position: absolute;
            width: 50%;
            height: 100%;
            top: 0;
        }
        
        .butterfly_wrapper .leftwings {
            left: 0;
        }
        
        .butterfly_wrapper .rightwings {
            right: 0;
        }
        
        .butterfly_wrapper .perspective {
            position: relative;
            width: 100%;
            height: 50%;
            perspective: 150px;
            perspective-origin: 50% 50%;
        }
        
        .butterfly_wrapper .upperwing,
        .butterfly_wrapper .lowerwing {
            animation-duration: 0.3s;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        
        .butterfly_wrapper .upperwing {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .butterfly_wrapper .upperwing_left {
            border-top-left-radius: 10%;
            border-top-right-radius: 80%;
            border-bottom-right-radius: 0%;
            border-bottom-left-radius: 30%;
            transform-origin: 100% 50%;
            animation-name: movewing_left;
        }
        
        .butterfly_wrapper .upperwing_right {
            border-top-left-radius: 80%;
            border-top-right-radius: 10%;
            border-bottom-right-radius: 30%;
            border-bottom-left-radius: 0%;
            transform-origin: 0% 50%;
            animation-name: movewing_right;
        }
        
        .butterfly_wrapper .lowerwing {
            position: absolute;
            top: 0;
            width: 80%;
            height: 80%;
        }
        
        .butterfly_wrapper .lowerwing_left {
            right: 0;
            border-top-left-radius: 30%;
            border-top-right-radius: 0%;
            border-bottom-right-radius: 80%;
            border-bottom-left-radius: 10%;
            transform-origin: 100% 50%;
            animation-name: movewing_left;
        }
        
        .butterfly_wrapper .lowerwing_right {
            left: 0;
            border-top-left-radius: 0%;
            border-top-right-radius: 30%;
            border-bottom-right-radius: 10%;
            border-bottom-left-radius: 80%;
            transform-origin: 0% 50%;
            animation-name: movewing_right;
        }
        
        @keyframes movewing_left {
            from {
                transform: rotateY(0deg);
            }
            to {
                transform: rotateY(65deg);
            }
        }
        
        @keyframes movewing_right {
            from {
                transform: rotateY(0deg);
            }
            to {
                transform: rotateY(-65deg);
            }
        }
        
        .message-bubble {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: bottom center;
            font-family: -apple-system, 'SF Pro Text', BlinkMacSystemFont, sans-serif;
            font-weight: 500;
            font-size: 13px;
            letter-spacing: -0.01em;
            line-height: 1.4;
            color: #3d3c3c;
            text-align: center;
            white-space: pre-line;
            background-color: rgba(241, 186, 186, 0.75);
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            width: max-content;
            max-width: 200px;
            min-width: min-content;
            padding: 6px 10px;
            margin-bottom: 6px;
            display: inline-block;
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none;
            z-index: 10;
            overflow-wrap: normal;
            word-break: keep-all;
            box-sizing: border-box;
        }
        
        .message-bubble.mono {
            font-family: 'SF Mono', Menlo, monospace;
            font-size: 12px;
            letter-spacing: 0;
            font-weight: normal;
        }
        
        @keyframes bubble-float {
            0% {
                transform: translateX(-50%) translateY(5px);
                opacity: 0;
            }
            100% {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .message-bubble.show {
            animation: bubble-float 0.3s ease-out forwards;
        }
        
        .message-bubble.multiline {
            white-space: pre-line;
            width: max-content;
            max-width: 200px;
        }
        
        .yellow-word {
            color: #FFD700;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
            animation: yellowPulse 1.5s infinite alternate;
        }
        
        @media screen and (max-width: 600px) {
            h1 {
                font-size: 1.5em;
            }
            .butterfly_wrapper {
                width: 100px;
                height: 100px;
            }
            .final-title {
                font-size: 2.5rem;
            }
            .final-image {
                height: 40vh;
            }
        }
        
        @media screen and (min-width: 601px) and (max-width: 1024px) {
            h1 {
                font-size: 1.8em;
            }
        }
        
        @media screen and (min-width: 1025px) {
            h1 {
                font-size: 2em;
            }
        }
        
        .final-butterfly {
            position: fixed;
            z-index: 10;
            width: 50px;
            height: 50px;
        }
        
        .landing-spot-active {
            background-color: rgba(202, 117, 114, 0.3);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(202, 117, 114, 0.5);
            transition: all 0.5s ease;
        }
        
        .final-butterfly.landing {
            pointer-events: auto;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .final-butterfly.landing:active {
            transform: scale(0.9);
        }
        
        .stay-message {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(241, 186, 186, 0.85);
            color: #3d3c3c;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 350;
        }
        
        .stay-message.visible {
            opacity: 1;
        }
    </style>
</head>

<body>
    <h1 class="titulo">ÿ£ŸÜÿß ŸÖÿ∫ÿ±ŸÖ ÿ®ŸÉ ŸÅÿßŸäÿ≤ÿ©</h1>
    <div class="flower">
        <img class="imagen" src="Flower/IMG_4925.jpg" alt="Girasoles" />
    </div>
    <div class="score-container">
        <div class="gotcha-title">Butterfly<br>Gotcha!</div>
        <span class="score-value">0</span>
    </div>

    <div id="final-state">
        <h1 class="final-title">ÿ¢ÿ≥ŸÅ</h1>
        <div class="final-flower">
            <img class="final-image" src="Flower/IMG_4978.jpeg" alt="Our Love" />
            <div id="landing-spot-1" style="position: absolute; width: 17px; height: 18px; top: 8%; left: 55%; transform: translate(-50%, -50%); pointer-events: none;"></div>
            <div id="landing-spot-2" style="position: absolute; width: 17px; height: 18px; top: 12%; left: 22%; transform: translate(-50%, -50%); pointer-events: none;"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const body = document.body;
            const numFireflies = 30;
            let firstButterflyCreated = false;
            let score = 0;
            const scoreElement = document.querySelector('.score-value');
            let activeButterflies = [];
            let animationFrameCount = 0;

            document.getElementById('final-state').classList.add('hidden');

            createInitialElements();

            const messages = [
                "You're my\nJaaduuuu!",
                "JAADUU‚ú®",
                "Hubun!‚ù§Ô∏è",
                "La di da di daa",
                "Innocently\nIntimidating",
                "Please don't\ngive up on me",
                "You're more than\n all these flowers!",
                "You're blessing!",
                "Miluji tƒõbe",
                "Je t'aime",
                "Te amo",
                "√Ä toi pour\ntoujours!",
                "You're\nMy Eid!",
                "Dooset dƒÅram",
                "Moonlight!",
                "Sorrryüòî",
                "Mann jaw\nna pls",
                "RAWRR!",
                "I really wanna\nmake things right!",
                "You're\nHOPE!",
                "You're\nPoetry",
                "You're\nPeace!",
                "You're\nHome!",
                "You're my\n<span class='yellow-word'>YELLOW</span>",
                "You're my\n<span class='yellow-word'>YELLOW</span>",
                "You're my\n<span class='yellow-word'>YELLOW</span>",
                "You're my\n<span class='yellow-word'>YELLOW</span>",
                "Girl, I never\nloved one like you",
                "You're my\nSukooon!",
                "You're quite\nA dream!",
                "I'll stand\nby your side!",
                "I'm hell\nobsessed\nwith you!",
                "Save Me\nplease!",
                "You're my\nBarakah!",
                "You're my\nBarakah!",
                "You're my\nDuniyaa!",
                "There is noone\nlike Bushraa!",
                "You're soo\nPrecious!",
                "Maaf koree\ndewnah Bhai!",
                "You're my\nSimple Thing",
                "Can I have\nmy blessing?",
                "Can you break\nWall of silence",
                "Faizaaaaaa!\nI Need you!",
                "I'm sorry\nfor everything!",
                "You mean\nEverything!",
                "Remember?\nthose verses?",
                "Where are\nthose trolls?",
                "Damn you're\nmy Nooor!",
                "Want to fight\nfor my Love",
                "Me paused\nwithout you!",
                "I'm not giving\nup on youuuu!",
                "You're precious\nThan anything",
                "You're my\nAudacity!",
                "You're my\nAudacity!",
                "You're my\nAudacity!",
                "You're my\nTahajjud!",
                "You're my\nTahajjud!",
                "You're my\nTahajjud!",
                "You're all over\nmy prayers!",
                "You're my\nPrayer!"

            ];

            const butterflyColors = [{
                name: "vibrant-orange",
                gradient: "radial-gradient(ellipse at center, #FF4400 0%, #FFEE00 50%, #FF4400 100%)"
            }, {
                name: "vibrant-lavender",
                gradient: "radial-gradient(ellipse at center, #9D4EDD 0%, #E0AAFF 50%, #9D4EDD 100%)"
            }, {
                name: "bold-pink",
                gradient: "radial-gradient(ellipse at center, #FF2D75 0%, #FF8FAB 50%, #FF2D75 100%)"
            }, {
                name: "soft-peach",
                gradient: "radial-gradient(ellipse at center, #FF9A8B 0%, #FFC3A0 50%, #FF9A8B 100%)"
            }];

            function createInitialElements() {
                for (let i = 0; i < numFireflies; i++) {
                    setTimeout(() => {
                        createFirefly();
                        if (i === numFireflies - 2) {
                            setInterval(createFirefly, 1200);
                        }
                    }, i * 150);
                }

                const butterflyCount = 10;
                for (let i = 0; i < butterflyCount; i++) {
                    setTimeout(() => {
                        const isFirstButterfly = !firstButterflyCreated;
                        createButterfly(isFirstButterfly);
                        firstButterflyCreated = true;
                    }, i * 1000);
                }
            }

            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space' || event.code === 'Enter') {
                    if (activeButterflies.length > 0) {
                        const randomIndex = Math.floor(Math.random() * activeButterflies.length);
                        const butterfly = activeButterflies[randomIndex];

                        const clickEvent = new MouseEvent('click', {
                            view: window,
                            bubbles: true,
                            cancelable: true
                        });
                        butterfly.dispatchEvent(clickEvent);
                    }
                }
            });

            function updateScore(points = 1) {
                score += points;
                scoreElement.textContent = score;

                const gotchaTitle = document.querySelector('.gotcha-title');
                gotchaTitle.style.transform = 'scale(1.2)';
                gotchaTitle.style.color = '#FF6347';
                setTimeout(() => {
                    gotchaTitle.style.transform = 'scale(1)';
                    gotchaTitle.style.color = '#FFD700';
                }, 300);

                scoreElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    scoreElement.style.transform = 'scale(1)';
                }, 200);

                if (score % 10 === 0) {
                    createButterflyExplosion();
                }

                if (score === 30) {
                    activateFinalState();
                }
            }

            function activateFinalState() {
                document.querySelectorAll('.score-container, .flower, .titulo')
                    .forEach(el => el.remove());

                document.body.style.background = '#EDE5E2';

                const finalState = document.getElementById('final-state');
                finalState.classList.remove('hidden');

                setTimeout(() => {
                    finalState.classList.add('visible');

                    const checkImageLoaded = setInterval(() => {
                        const img = document.querySelector('.final-image');
                        if (img.complete && img.naturalHeight !== 0) {
                            clearInterval(checkImageLoaded);
                            setTimeout(() => {
                                createFinalButterflies();
                            }, 300);
                        }
                    }, 100);
                }, 100);
            }

            function createFinalButterflies() {
                createLandingButterfly();

                setTimeout(() => {
                    for (let i = 0; i < 3; i++) {
                        createDecorativeButterfly();
                    }
                }, 2500);
            }

            function cubicBezier(p0, p1, p2, p3, t) {
                const mt = 1 - t;
                return mt * mt * mt * p0 + 3 * mt * mt * t * p1 + 3 * mt * t * t * p2 + t * t * t * p3;
            }

            function easeOutQuad(t) {
                return t * (2 - t);
            }


            function createLandingButterfly() {
                const landingSpots = [
                    document.getElementById('landing-spot-1'),
                    document.getElementById('landing-spot-2')
                ];

                let currentSpotIndex = Math.floor(Math.random() * landingSpots.length);
                const landingSpot = landingSpots[currentSpotIndex];
                landingSpot.classList.add('landing-spot-active');

                const butterfly = document.createElement('div');
                butterfly.className = 'butterfly_wrapper final-butterfly landing';
                butterfly.style.cssText = `
        width: 50px;
        height: 50px;
        opacity: 0;
        position: absolute;
        z-index: 300;
        touch-action: manipulation;
    `;

                butterfly.innerHTML = `
        <div class="leftwings">
            <div class="perspective">
                <div class="upperwing upperwing_left"></div>
            </div>
            <div class="perspective">
                <div class="lowerwing lowerwing_left"></div>
            </div>
        </div>
        <div class="rightwings">
            <div class="perspective">
                <div class="upperwing upperwing_right"></div>
            </div>
            <div class="perspective">
                <div class="lowerwing lowerwing_right"></div>
            </div>
        </div>
        <div class="stay-message">I'm here to stay!</div>
    `;

                const wings = butterfly.querySelectorAll('.upperwing, .lowerwing');
                wings.forEach(wing => {
                    wing.style.background = "radial-gradient(ellipse at center, #9D4EDD 0%, #E0AAFF 50%, #94D4ED 100%)";
                });

                document.getElementById('final-state').appendChild(butterfly);

                const flyToNewSpot = () => {
                    const message = butterfly.querySelector('.stay-message');
                    message.classList.remove('visible');

                    landingSpots[currentSpotIndex].classList.remove('landing-spot-active');

                    let newSpotIndex;
                    do {
                        newSpotIndex = Math.floor(Math.random() * landingSpots.length);
                    } while (newSpotIndex === currentSpotIndex);

                    currentSpotIndex = newSpotIndex;
                    const newSpot = landingSpots[currentSpotIndex];
                    newSpot.classList.add('landing-spot-active');

                    const startX = parseFloat(butterfly.style.left);
                    const startY = parseFloat(butterfly.style.top);
                    const spotRect = newSpot.getBoundingClientRect();
                    const targetX = spotRect.left + spotRect.width / 2;
                    const targetY = spotRect.top + spotRect.height / 2;

                    wings.forEach(wing => {
                        wing.style.animationDuration = '0.1s';
                    });

                    const duration = 3200;
                    const startTime = performance.now();

                    const controlPoints = [{
                        x: startX + (targetX - startX) * 0.2,
                        y: startY - 80
                    }, {
                        x: startX + (targetX - startX) * 0.5,
                        y: startY - 120
                    }, {
                        x: startX + (targetX - startX) * 0.8,
                        y: targetY - 60
                    }];

                    const animateFlight = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const easeProgress = easeInOutQuad(progress);

                        const x = cubicBezier(startX, controlPoints[0].x, controlPoints[1].x, targetX, easeProgress);
                        const y = cubicBezier(startY, controlPoints[0].y, controlPoints[1].y, targetY, easeProgress);

                        const nextX = cubicBezier(startX, controlPoints[0].x, controlPoints[1].x, targetX, Math.min(progress + 0.05, 1));
                        const nextY = cubicBezier(startY, controlPoints[0].y, controlPoints[1].y, targetY, Math.min(progress + 0.05, 1));
                        const angle = Math.atan2(nextY - y, nextX - x) * (180 / Math.PI);

                        butterfly.style.left = `${x}px`;
                        butterfly.style.top = `${y}px`;
                        butterfly.style.transform = `rotate(${angle}deg)`;

                        const scale = 0.9 + 0.1 * Math.sin(progress * Math.PI);
                        butterfly.style.transform = `rotate(${angle}deg) scale(${scale})`;

                        // Add fast flapping when about to land (last 20% of progress)
                        if (progress > 0.7) {
                            wings.forEach(wing => {
                                wing.style.animationDuration = '0.07s';
                            });
                        }

                        if (progress < 1) {
                            requestAnimationFrame(animateFlight);
                        } else {
                            wings.forEach(wing => {
                                wing.style.animationDuration = '0.1s';
                            });

                            butterfly.style.transform = 'rotate(0deg) scale(1)';

                            setTimeout(() => {
                                message.classList.add('visible');
                                setTimeout(() => {
                                    message.classList.remove('visible');
                                }, 2000);
                            }, 500);
                        }
                    };

                    requestAnimationFrame(animateFlight);
                };

                function easeInOutQuad(t) {
                    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
                }

                function cubicBezier(p0, p1, p2, p3, t) {
                    const mt = 1 - t;
                    return mt * mt * mt * p0 + 3 * mt * mt * t * p1 + 3 * mt * t * t * p2 + t * t * t * p3;
                }

                function showFullWings() {
                    wings.forEach(wing => {
                        wing.style.transform = 'rotateY(0deg)';
                        wing.style.animation = 'none';
                    });
                }

                function startFastFlapping() {
                    wings.forEach(wing => {
                        if (wing.classList.contains('upperwing_right') ||
                            wing.classList.contains('lowerwing_right')) {
                            wing.style.animation = 'movewing_right 0.15s infinite alternate';
                        } else {
                            wing.style.animation = 'movewing_left 0.15s infinite alternate';
                        }
                    });
                }

                function startPausePlayLoop() {
                    showFullWings();

                    setTimeout(() => {
                        startFastFlapping();

                        setTimeout(() => {
                            showFullWings();

                            setTimeout(() => {
                                startFastFlapping();

                                startPausePlayLoop();
                            }, 1000);
                        }, 2000);
                    }, 1000);
                }

                setTimeout(() => {
                    butterfly.animate([{
                        opacity: 0
                    }, {
                        opacity: 1
                    }], {
                        duration: 1000,
                        fill: 'forwards'
                    });

                    const startX = -100;
                    const startY = window.innerHeight * 0.3;
                    butterfly.style.left = `${startX}px`;
                    butterfly.style.top = `${startY}px`;

                    const landingRect = landingSpot.getBoundingClientRect();
                    const targetX = landingRect.left + landingRect.width / 2;
                    const targetY = landingRect.top + landingRect.height / 2;

                    const controlPoints = [{
                        x: window.innerWidth * 0.2,
                        y: window.innerHeight * 0.1
                    }, {
                        x: window.innerWidth * 0.5,
                        y: window.innerHeight * 0.2
                    }, {
                        x: window.innerWidth * 0.7,
                        y: window.innerHeight * 0.3
                    }];

                    const flightDuration = 4000;
                    const startTime = performance.now();

                    function animateFlight(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / flightDuration, 1);
                        const easeProgress = easeInOutQuad(progress);

                        const x = cubicBezier(startX, controlPoints[0].x, controlPoints[1].x, targetX, easeProgress);
                        const y = cubicBezier(startY, controlPoints[0].y, controlPoints[1].y, targetY, easeProgress);

                        const nextX = cubicBezier(startX, controlPoints[0].x, controlPoints[1].x, targetX, Math.min(progress + 0.05, 1));
                        const nextY = cubicBezier(startY, controlPoints[0].y, controlPoints[1].y, targetY, Math.min(progress + 0.05, 1));
                        const angle = Math.atan2(nextY - y, nextX - x) * (180 / Math.PI);

                        butterfly.style.left = `${x}px`;
                        butterfly.style.top = `${y}px`;
                        butterfly.style.transform = `rotate(${angle}deg)`;

                        const scale = 0.8 + 0.2 * Math.sin(progress * Math.PI);
                        butterfly.style.transform = `rotate(${angle}deg) scale(${scale})`;

                        const wingSpeed = 0.2 + 0.1 * Math.sin(progress * Math.PI * 2);
                        wings.forEach(wing => {
                            wing.style.animationDuration = `${wingSpeed}s`;
                        });

                        if (progress < 1) {
                            requestAnimationFrame(animateFlight);
                        } else {
                            startPausePlayLoop();

                            butterfly.addEventListener('click', flyToNewSpot);
                            butterfly.addEventListener('touchstart', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                flyToNewSpot();
                            });
                        }
                    }

                    requestAnimationFrame(animateFlight);

                    setTimeout(() => {
                        landingSpot.classList.remove('landing-spot-active');
                    }, flightDuration);
                }, 300);
            }

            function createDecorativeButterfly() {
                const butterfly = document.createElement('div');
                butterfly.className = 'butterfly_wrapper final-butterfly';

                const size = 40 + Math.random() * 40;
                butterfly.style.width = `${size}px`;
                butterfly.style.height = `${size}px`;

                butterfly.innerHTML = `
                    <div class="leftwings">
                        <div class="perspective">
                            <div class="upperwing upperwing_left"></div>
                        </div>
                        <div class="perspective">
                            <div class="lowerwing lowerwing_left"></div>
                        </div>
                    </div>
                    <div class="rightwings">
                        <div class="perspective">
                            <div class="upperwing upperwing_right"></div>
                        </div>
                        <div class="perspective">
                            <div class="lowerwing lowerwing_right"></div>
                        </div>
                    </div>
                `;

                const color = butterflyColors[Math.floor(Math.random() * butterflyColors.length)];

                const wings = butterfly.querySelectorAll('.upperwing, .lowerwing');
                wings.forEach(wing => {
                    wing.style.animation = wing.classList.contains('upperwing_right') ||
                        wing.classList.contains('lowerwing_right') ?
                        'movewing_right 0.3s infinite alternate' :
                        'movewing_left 0.3s infinite alternate';
                });

                const startX = Math.random() * window.innerWidth;
                const startY = Math.random() * window.innerHeight;
                butterfly.style.left = `${startX}px`;
                butterfly.style.top = `${startY}px`;
                butterfly.style.zIndex = '10';

                document.body.appendChild(butterfly);

                let angle = 0;
                let floatDirection = 1;

                function floatAnimation() {
                    angle += 0.01 * floatDirection;
                    if (Math.abs(angle) > 0.1) floatDirection *= -1;

                    const offsetY = Math.sin(performance.now() / 1000) * 20;
                    const offsetX = Math.cos(performance.now() / 1200) * 10;

                    butterfly.style.transform = `translate(${offsetX}px, ${offsetY}px) rotate(${angle}deg)`;

                    requestAnimationFrame(floatAnimation);
                }

                floatAnimation();
            }

            function createButterflyExplosion() {
                activeButterflies.forEach(butterfly => {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 3 + Math.random() * 7;
                    butterfly.dataset.velocityX = Math.cos(angle) * speed;
                    butterfly.dataset.velocityY = Math.sin(angle) * speed;
                    butterfly.dataset.rotationSpeed = (Math.random() - 0.5) * 25;
                    butterfly.dataset.currentRotation = 0;

                    const wings = butterfly.querySelectorAll('.upperwing, .lowerwing');
                    wings.forEach(wing => {
                        wing.style.animationDuration = '0.1s';
                    });

                    animateExplodingButterfly(butterfly);
                });

                for (let i = 0; i < 100; i++) {
                    setTimeout(() => {
                        const explosionButterfly = document.createElement('div');
                        explosionButterfly.className = 'butterfly_wrapper explosion-butterfly';
                        explosionButterfly.style.position = 'absolute';
                        explosionButterfly.style.zIndex = '1000';

                        explosionButterfly.innerHTML = `
                <div class="leftwings">
                    <div class="perspective">
                        <div class="upperwing upperwing_left"></div>
                    </div>
                    <div class="perspective">
                        <div class="lowerwing lowerwing_left"></div>
                    </div>
                </div>
                <div class="rightwings">
                    <div class="perspective">
                        <div class="upperwing upperwing_right"></div>
                    </div>
                    <div class="perspective">
                        <div class="lowerwing lowerwing_right"></div>
                    </div>
                </div>
            `;

                        const posX = Math.random() * window.innerWidth;
                        const posY = Math.random() * window.innerHeight;

                        explosionButterfly.style.left = `${posX}px`;
                        explosionButterfly.style.top = `${posY}px`;

                        const size = 20 + Math.random() * 30;
                        explosionButterfly.style.width = `${size}px`;
                        explosionButterfly.style.height = `${size}px`;

                        const color = butterflyColors[Math.floor(Math.random() * butterflyColors.length)];
                        const wings = explosionButterfly.querySelectorAll('.upperwing, .lowerwing');
                        wings.forEach(wing => {
                            wing.style.background = color.gradient;
                            wing.style.animationDuration = '0.1s';
                        });

                        document.body.appendChild(explosionButterfly);

                        const angle = Math.random() * Math.PI * 2;
                        const speed = 1 + Math.random() * 4;
                        explosionButterfly.dataset.velocityX = Math.cos(angle) * speed;
                        explosionButterfly.dataset.velocityY = Math.sin(angle) * speed;
                        explosionButterfly.dataset.rotationSpeed = (Math.random() - 0.5) * 20;
                        explosionButterfly.dataset.currentRotation = 0;
                        explosionButterfly.dataset.life = 200 + Math.random() * 200;
                        explosionButterfly.dataset.startTime = Date.now();

                        animateExplosionParticle(explosionButterfly);

                    }, i * 10);
                }

                activeButterflies = [];

                setTimeout(() => {
                    for (let i = 0; i < 10; i++) {
                        setTimeout(() => {
                            createButterfly();
                        }, i * 300);
                    }
                }, 1500);
            }

            function animateExplodingButterfly(butterfly) {
                if (!butterfly.isConnected) return;

                let x = parseFloat(butterfly.style.left);
                let y = parseFloat(butterfly.style.top);

                x += parseFloat(butterfly.dataset.velocityX);
                y += parseFloat(butterfly.dataset.velocityY);

                butterfly.dataset.currentRotation = parseFloat(butterfly.dataset.currentRotation) +
                    parseFloat(butterfly.dataset.rotationSpeed);

                butterfly.style.left = `${x}px`;
                butterfly.style.top = `${y}px`;
                butterfly.style.transform = `rotate(${butterfly.dataset.currentRotation}deg)`;

                butterfly.style.opacity = parseFloat(butterfly.style.opacity) - 0.002;

                if (parseFloat(butterfly.style.opacity) > 0) {
                    requestAnimationFrame(() => animateExplodingButterfly(butterfly));
                } else {
                    butterfly.remove();
                }
            }

            function animateExplosionParticle(particle) {
                if (!particle.isConnected) return;

                const lifeProgress = (Date.now() - particle.dataset.startTime) / particle.dataset.life;

                let x = parseFloat(particle.style.left);
                let y = parseFloat(particle.style.top);

                x += parseFloat(particle.dataset.velocityX);
                y += parseFloat(particle.dataset.velocityY);

                particle.dataset.velocityX *= 0.98;
                particle.dataset.velocityY *= 0.98;

                particle.dataset.currentRotation = parseFloat(particle.dataset.currentRotation) +
                    parseFloat(particle.dataset.rotationSpeed);

                particle.style.transform = `rotate(${particle.dataset.currentRotation}deg) scale(${1 - (lifeProgress * 0.3)})`;

                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;

                particle.style.opacity = 1 - lifeProgress;

                if (Math.random() > 0.95) {
                    particle.dataset.velocityX += (Math.random() - 0.5) * 3;
                    particle.dataset.velocityY += (Math.random() - 0.5) * 3;
                }

                if (lifeProgress < 1) {
                    requestAnimationFrame(() => animateExplosionParticle(particle));
                } else {
                    particle.remove();
                }
            }

            function createButterfly(isFirstButterfly = false, isFinalState = false) {
                const butterfly = document.createElement('div');
                butterfly.className = 'butterfly_wrapper';

                butterfly.innerHTML = `
                    <div class="leftwings">
                        <div class="perspective">
                            <div class="upperwing upperwing_left"></div>
                        </div>
                        <div class="perspective">
                            <div class="lowerwing lowerwing_left"></div>
                        </div>
                    </div>
                    <div class="rightwings">
                        <div class="perspective">
                            <div class="upperwing upperwing_right"></div>
                        </div>
                        <div class="perspective">
                            <div class="lowerwing lowerwing_right"></div>
                        </div>
                    </div>
                `;

                const color = butterflyColors[Math.floor(Math.random() * butterflyColors.length)];
                const wings = butterfly.querySelectorAll('.upperwing, .lowerwing');
                wings.forEach(wing => {
                    wing.style.background = color.gradient;
                });

                const messageBubble = document.createElement('div');
                messageBubble.className = 'message-bubble';
                butterfly.appendChild(messageBubble);

                const startX = isFirstButterfly ?
                    window.innerWidth / 2 + (Math.random() * 100 - 50) :
                    Math.random() * (window.innerWidth - 100);
                const startY = isFirstButterfly ?
                    window.innerHeight / 2 + (Math.random() * 100 - 50) :
                    Math.random() * (window.innerHeight - 100);

                butterfly.style.left = `${startX}px`;
                butterfly.style.top = `${startY}px`;

                const initialSize = 20 + Math.random() * 40;
                butterfly.style.width = `${initialSize}px`;
                butterfly.style.height = `${initialSize}px`;

                if (isFinalState) {
                    butterfly.style.pointerEvents = 'none';
                    butterfly.style.cursor = 'default';
                } else {
                    body.appendChild(butterfly);
                    activeButterflies.push(butterfly);
                }

                let currentX = startX;
                let currentY = startY;
                let angle = Math.random() * Math.PI * 2;
                let speed = 0.5 + Math.random() * 1.5;
                let turnSpeed = 0.05 + Math.random() * 0.1;
                let turnFrequency = 50 + Math.random() * 100;
                let turnCounter = 0;
                let size = initialSize;
                let rotation = 0;
                let isFlipped = false;
                let shouldAnimate = true;

                if (isFirstButterfly) {
                    setTimeout(() => {
                        const firstMessages = [
                            "Babukhalamonii\nTap! Tap! Tap!",
                            "Babukhalamoniii\nCatch butterflies"
                        ];

                        const randomFirstMessage = firstMessages[Math.floor(Math.random() * firstMessages.length)];
                        messageBubble.innerHTML = randomFirstMessage;
                        messageBubble.style.opacity = '1';

                        setTimeout(() => {
                            messageBubble.style.opacity = '0';
                            butterfly.style.opacity = '0';

                            setTimeout(() => {
                                butterfly.remove();
                                shouldAnimate = false;
                                activeButterflies = activeButterflies.filter(b => b !== butterfly);
                            }, 1000);
                        }, 3000);
                    }, 1500);
                }

                if (!isFinalState) {
                    const trackButterflyClick = (event) => {
                        showRandomMessage(messageBubble);
                        updateScore();

                        butterfly.style.transform = 'scale(0.9)';
                        setTimeout(() => {
                            butterfly.style.transform = '';
                        }, 200);

                        if (typeof gtag !== 'undefined') {
                            gtag('event', 'butterfly_click', {
                                'event_category': 'engagement',
                                'event_label': color.name,
                                'interaction_type': event.type,
                                'screen_x': event.clientX,
                                'screen_y': event.clientY,
                                'butterfly_size': size,
                                'message_shown': messages[Math.floor(Math.random() * messages.length)].substring(0, 20)
                            });
                        }
                    };

                    butterfly.addEventListener('click', trackButterflyClick);
                    butterfly.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        trackButterflyClick(e);
                    });
                }

                function animateButterfly() {
                    if (!shouldAnimate) return;

                    if ('ontouchstart' in window && animationFrameCount % 2 === 0) {
                        requestAnimationFrame(animateButterfly);
                        animationFrameCount++;
                        return;
                    }
                    animationFrameCount++;

                    turnCounter++;
                    if (turnCounter >= turnFrequency) {
                        angle += (Math.random() - 0.5) * Math.PI * turnSpeed;
                        turnCounter = 0;
                        turnFrequency = 50 + Math.random() * 100;
                    }

                    if (Math.random() > 0.95) {
                        size += (Math.random() - 0.5) * 10;
                        size = Math.max(20, Math.min(60, size));
                    }

                    if (Math.random() > 0.9) {
                        rotation += (Math.random() - 0.5) * 10;
                    }

                    currentX += Math.cos(angle) * speed;
                    currentY += Math.sin(angle) * speed;

                    if (currentX < -100) currentX = window.innerWidth;
                    else if (currentX > window.innerWidth + 100) currentX = -100;

                    if (currentY < -100) currentY = window.innerHeight;
                    else if (currentY > window.innerHeight + 100) currentY = -100;

                    butterfly.style.left = `${currentX}px`;
                    butterfly.style.top = `${currentY}px`;
                    butterfly.style.width = `${size}px`;
                    butterfly.style.height = `${size}px`;

                    const newIsFlipped = Math.cos(angle) <= 0;
                    if (newIsFlipped !== isFlipped) {
                        isFlipped = newIsFlipped;
                        butterfly.style.transform = `rotate(${rotation}deg) scaleX(${isFlipped ? -1 : 1})`;
                        messageBubble.style.transform = `translateX(-50%) scaleX(${isFlipped ? -1 : 1})`;
                    } else {
                        butterfly.style.transform = `rotate(${rotation}deg) scaleX(${isFlipped ? -1 : 1})`;
                    }

                    requestAnimationFrame(animateButterfly);
                }

                animateButterfly();
            }

            function showRandomMessage(bubble) {
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                bubble.innerHTML = randomMessage;
                bubble.style.opacity = '1';



                setTimeout(() => {
                    bubble.style.opacity = '0';
                }, 2600);
            }

            function createFirefly(isFinalState = false) {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';

                let posX, posY;
                if (Math.random() > 0.4) {
                    const clusterX = window.innerWidth / 2;
                    const clusterY = window.innerHeight / 2;
                    posX = clusterX + (Math.random() - 0.5) * 400;
                    posY = clusterY + (Math.random() - 0.5) * 300;
                } else {
                    posX = Math.random() * window.innerWidth;
                    posY = Math.random() * window.innerHeight;
                }

                firefly.style.left = `${posX}px`;
                firefly.style.top = `${posY}px`;

                const size = 4 + Math.random() * 8;
                firefly.style.width = `${size}px`;
                firefly.style.height = `${size}px`;
                firefly.style.opacity = '0';

                let hue, saturation;
                if (isFinalState) {
                    hue = 10 + Math.random() * 20;
                    saturation = 60 + Math.random() * 30;
                } else {
                    hue = 40 + Math.random() * 30;
                    saturation = 70 + Math.random() * 30;
                }

                const baseColor = `hsla(${hue}, ${saturation}%, 80%, 1)`;
                firefly.style.backgroundColor = baseColor;
                firefly.style.boxShadow = `0 0 ${10 + Math.random() * 10}px ${3 + Math.random() * 5}px ${baseColor}`;

                body.appendChild(firefly);
                animateFirefly(firefly);
            }

            function animateFirefly(firefly) {
                const lifespan = 8000 + Math.random() * 7000;
                const baseMoveDuration = 2000 + Math.random() * 5000;
                const baseGlowDuration = 200 + Math.random() * 800;
                const maxGlowVariation = 0.4 + Math.random() * 0.4;
                const startTime = performance.now();

                firefly.animate([{
                    opacity: 0
                }, {
                    opacity: 0.6 + Math.random() * 0.4
                }], {
                    duration: 600 + Math.random() * 900,
                    fill: 'forwards'
                });

                function startGlowAnimation() {
                    const currentGlowDuration = baseGlowDuration * (0.7 + Math.random() * 0.6);
                    const currentGlowVariation = maxGlowVariation * (0.5 + Math.random());

                    const glowAnimation = firefly.animate([{
                        opacity: 0.6 + Math.random() * 0.4,
                        boxShadow: firefly.style.boxShadow
                    }, {
                        opacity: 0.3 + Math.random() * 0.2,
                        boxShadow: `0 0 ${parseInt(firefly.style.boxShadow.split(' ')[2]) * (0.4 + Math.random() * 0.3)}px ${parseInt(firefly.style.boxShadow.split(' ')[4]) * (0.4 + Math.random() * 0.3)}px ${firefly.style.boxShadow.split(' ')[5]}`
                    }, {
                        opacity: 0.6 + Math.random() * 0.4,
                        boxShadow: firefly.style.boxShadow
                    }], {
                        duration: currentGlowDuration,
                        iterations: 1,
                        easing: 'ease-in-out'
                    });

                    glowAnimation.onfinish = () => {
                        if (performance.now() - startTime < lifespan) {
                            startGlowAnimation();
                        }
                    };
                }

                startGlowAnimation();

                let currentX = parseFloat(firefly.style.left);
                let currentY = parseFloat(firefly.style.top);
                let horizontalBias = Math.random() > 0.5 ? 1 : -1;
                let verticalBias = Math.random() > 0.5 ? 1 : -1;

                function moveFirefly() {
                    const moveDuration = baseMoveDuration * (0.7 + Math.random() * 0.6);
                    const angle = (Math.random() * Math.PI / 3) - Math.PI / 6;
                    const baseAngle = Math.atan2(verticalBias, horizontalBias);
                    const finalAngle = baseAngle + angle;
                    const distance = 50 + Math.random() * 200;
                    const newX = currentX + Math.cos(finalAngle) * distance;
                    const newY = currentY + Math.sin(finalAngle) * distance;

                    if (Math.random() > 0.8) horizontalBias *= -1;
                    if (Math.random() > 0.8) verticalBias *= -1;

                    const moveAnim = firefly.animate([{
                        transform: 'translate(0, 0)'
                    }, {
                        transform: `translate(${newX - currentX}px, ${newY - currentY}px)`
                    }], {
                        duration: moveDuration,
                        easing: 'ease-in-out',
                        fill: 'forwards'
                    });

                    moveAnim.onfinish = () => {
                        currentX = newX;
                        currentY = newY;

                        if (currentX < 0 || currentX > window.innerWidth) horizontalBias *= -1;
                        if (currentY < 0 || currentY > window.innerHeight) verticalBias *= -1;

                        if (performance.now() - startTime < lifespan) {
                            moveFirefly();
                        }
                    };
                }

                moveFirefly();

                setTimeout(() => {
                    firefly.animate([{
                        opacity: parseFloat(firefly.style.opacity)
                    }, {
                        opacity: 0
                    }], {
                        duration: 1000 + Math.random() * 1000,
                        fill: 'forwards'
                    }).onfinish = () => {
                        firefly.remove();
                    };
                }, lifespan);
            }
        });
    </script>
</body>

</html>
